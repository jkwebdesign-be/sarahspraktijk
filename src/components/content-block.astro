---
interface Props {
  title?: string;
  subtitle?: string;
  leftWidth?: string;
  rightWidth?: string;
  gap?: 'small' | 'medium' | 'large' | 'xlarge';
  padding?: 'none' | 'small' | 'medium' | 'large';
  verticalAlign?: 'top' | 'center' | 'bottom';
  backgroundColor?: string;
  reverseOnMobile?: boolean;
  matchHeight?: boolean;
}

const {
  title,
  subtitle,
  leftWidth = '50%',
  rightWidth = '50%',
  gap = 'medium',
  padding = 'medium',
  verticalAlign = 'center',
  backgroundColor,
  reverseOnMobile = false,
  matchHeight = false
} = Astro.props;

const gapMap = {
  'small': 'var(--space-6)',
  'medium': 'var(--space-12)',
  'large': 'var(--space-16)',
  'xlarge': 'var(--space-24)',
};

const paddingMap = {
  'none': '0',
  'small': 'var(--space-8)',
  'medium': 'var(--space-16)',
  'large': 'var(--space-24)',
};

const alignMap = {
  'top': 'flex-start',
  'center': 'center',
  'bottom': 'flex-end',
};
---

<section 
  class={`content-block ${reverseOnMobile ? 'content-block--reverse-mobile' : ''} ${matchHeight ? 'content-block--match-height' : ''}`}
  style={`
    --left-width: ${leftWidth};
    --right-width: ${rightWidth};
    --gap: ${gapMap[gap]};
    --padding: ${paddingMap[padding]};
    --align: ${alignMap[verticalAlign]};
    ${backgroundColor ? `background-color: ${backgroundColor};` : ''}
  `}
>
  {(title || subtitle) && (
    <div class="content-block__header">
      {title && <h2>{title}</h2>}
      {subtitle && <p class="subtitle">{subtitle}</p>}
    </div>
  )}
  
  <div class="content-block__container">
    <div class="content-block__left">
      <slot name="left" />
    </div>
    <div class="content-block__right">
      <slot name="right" />
    </div>
  </div>
</section>

<style>
  .content-block {
    width: 100%;
    padding: var(--padding);
  }

  .content-block__header {
    text-align: center;
    max-width: 1000px;
    margin: 0 auto var(--space-12) auto;
    padding: 0 var(--container-padding);
  }

  .content-block__header h2 {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-regular);
    line-height: var(--line-height-tight);
    color: var(--color-text);
    margin: 0 0 var(--space-3) 0;
  }

  .content-block__header .subtitle {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-medium);
    color: var(--color-text);
    margin: 0;
  }

  .content-block__container {
    display: grid;
    grid-template-columns: var(--left-width) var(--right-width);
    gap: var(--gap);
    max-width: var(--container-max);
    margin: 0 auto;
  }

  .content-block__left {
    display: flex;
    flex-direction: column;
    justify-content: var(--align);
    height: 100%;
  }

  .content-block__right {
    display: flex;
    flex-direction: column;
    justify-content: var(--align);
    height: 100%;
  }

  /* Base image styles - applies to all images */
  .content-block__left :global(img),
  .content-block__right :global(img) {
    width: 100%;
    height: auto;
    display: block;
    border-radius: var(--radius-md);
  }

  .content-block--match-height .content-block__left :global(img),
  .content-block--match-height .content-block__right :global(img) {
    max-height: 500px;
    width: auto; /* Changed from 100% */
    max-width: 100%; /* Prevents it from overflowing */
    object-fit: contain; /* Changed from cover - shows full image */
    margin: 0 auto; /* Centers the image */
  }

  /* responsive behavior */
  @media (max-width: 768px) {
    .content-block__container {
      grid-template-columns: 1fr;
      gap: var(--space-8);
    }

    .content-block--reverse-mobile .content-block__container {
      direction: rtl;
    }
    
    .content-block--reverse-mobile .content-block__left,
    .content-block--reverse-mobile .content-block__right {
      direction: ltr;
    }

    /* reset image height on mobile */
    .content-block__left :global(img),
    .content-block__right :global(img) {
      height: auto;
      max-height: none;
    }
  }
</style>